<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>搜索结果(有)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<script src="${link.contextPath}/js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="${link.contextPath}/css/index.css" type="text/css" />
<script src="${link.contextPath}/js/js.js"></script>
</head>
<body>
<div id="container">
    <div class="header">
		<a href="search.html"><div class="header-0">
			<div class="back">
				<div class="back-1">
					<img class="img1" src="${link.contextPath}/images/classfiy/back_n.png" />
					<img class="img2" src="${link.contextPath}/images/classfiy/back_p.png" />
				</div>
			</div>
		</div></a>
		<form id="searchForm" action="${link.contextPath}/product/search?startIndex=0&pageSize=8" method="POST">
		<div class="header-2">	
			<input type="text" class="search-text" placeholder="输入关键字" name="keyWord" value="$!{keyWord}"/>
		</div>
		</form>
		<a href="javascript:" class="btn" ><div class="header-3">
			<img src="${link.contextPath}/images/classfiy/search_n.png" />
			<img src="${link.contextPath}/images/classfiy/search_p.png" style="display:none" />
		</div></a>
    </div>
	<div class="success-search">
       <div class="success-1"><a href="javascript:" class="sort-1">新品优先</a></div>
       <div class="success-2">
			<a href="javascript:" class="sort-2">
				价格排序
				<span class="up">
					<img class="img1" src="${link.contextPath}/images/img/up_n.png" style="display:none;"/>
					<img class="img2" src="${link.contextPath}/images/img/up_p.png" style="display:block"/>
				</span>
				<span class="down">
					<img class="img1" src="${link.contextPath}/images/img/down_n.png" />
					<img class="img2" src="${link.contextPath}/images/img/down_p.png" style="display:none;" />
				</span>
			</a>
	   </div>
    </div>
    <div class="share-product">
    	#set($index = 0)
    	#foreach($product in $productList)
    		#if($index % 2 == 0)
    		<div class="product">
	            <div class="product-1">
	                <div class="product-img"><img src="$!{product.imgPath}"></div>
	                <div class="product-price">
						<span>$!{product.sellDesc}</span>
						<div class="price-footer">
							<div class="price-1">￥$!number.format("#0.00",$product.price)</div>
							<div class="price-2">￥$!number.format("#0.00",$product.applyPrice)</div>
						</div>
					</div>
	            </div>
            #else
            	<div class="product-2">
                	<div class="product-img"><img src="$!{product.imgPath}"></div>
                	<div class="product-price">
						<span>$!{product.sellDesc}</span>
						<div class="price-footer">
							<div class="price-1">￥$!number.format("#0.00",$product.price)</div>
							<div class="price-2">￥$!number.format("#0.00",$product.applyPrice)</div>
						</div>
					</div>
            	</div>
            </div>
            #end
            #set($index=$index+1)
    	#end
        
    </div>
</div>
</body>
<script type="text/javascript">
	$(function(){
		
		var isBottom = false;
		var startIndex = 8;
		var keyWord = "";
		
		
		$(window).scroll(function(){
			   var scrollTop = $(this).scrollTop();
			　　  var scrollHeight = $(document).height();
			　　  var windowHeight = $(this).height();
			　　  if(scrollTop + windowHeight == scrollHeight){
				  
				  keyWord = $(".search-text").val();
				  if(!keyWord||keyWord.trim()==""){
					  alert("请输入合法的参数");
					  return;
				  }
				  
				  if(!isBottom){
					  $.ajax({
						  url:"${link.contextPath}/product/ajaxSearch",
						  type:"POST",
						  data:"startIndex="+startIndex+"&pageSize=8&keyWord="+keyWord,
						  dataType:"json",
						  success:function(ret){
							  alert("ret.length: "+ret.length);
							  console.log(ret);
							  if(ret.length==8){
								  startIndex+=8;
							  }else{
								  isBottom = true;
							  }
							  
							  for(var i=0;i<ret.length;i++){
								  
								  if(i%2!=0){
									  $(".share-product").append('<div class="product"><div class="product-1"><div class="product-img"><img src="'+ret[i-1].imgPath+'"></div><div class="product-price"><span>'+ret[i-1].sellDesc+'</span><div class="price-footer"><div class="price-1">￥'+ret[i-1].price+'</div><div class="price-2">￥'+ret[i-1].applyPrice+'</div></div></div></div><div class="product-2"><div class="product-img"><img src="'+ret[i].imgPath+'"></div><div class="product-price"><span>'+ret[i].sellDesc+'</span><div class="price-footer"><div class="price-1">￥'+ret[i].price+'</div><div class="price-2">￥'+ret[i].applyPrice+'</div></div></div></div></div>');
								  }else{
									  if(i==ret.length-1){
										  $(".share-product").append('<div class="product"><div class="product-1"><div class="product-img"><img src="'+ret[i].imgPath+'"></div><div class="product-price"><span>'+ret[i].sellDesc+'</span><div class="price-footer"><div class="price-1">￥'+ret[i].price+'</div><div class="price-2">￥'+ret[i].applyPrice+'</div></div></div></div></div>');
									  }
								  }
								  
							  }
							  
							  
							  
						  }
					  });
				  }
			   }
		});
		
	});
</script>
</html>
